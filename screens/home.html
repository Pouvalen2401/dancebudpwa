<!-- Home Screen Partial - No HTML/HEAD/BODY tags -->
<style>
  /* Home Screen Specific Styles */
  #app-container {
    background: #0a0a0f;
    color: #ffffff;
    padding-bottom: 80px;
  }
  
  .app-header {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    padding: 20px;
    border-bottom: 1px solid rgba(59, 130, 246, 0.2);
    position: sticky;
    top: 0;
    z-index: 100;
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 16px;
  }
  
  .header-left {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 12px;
  }
  
  .logo-small {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    border-radius: 10px;
    display: grid;
    place-items: center;
  }

  /* Icons container - aligned horizontally on the right */
  .header-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  
  .settings-btn {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: grid;
    place-items: center;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .settings-btn:hover {
    background: rgba(59, 130, 246, 0.2);
    border-color: rgba(59, 130, 246, 0.5);
    transform: scale(1.05);
  }
  
  /* Stats Grid - Pure CSS Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }
  
  .stat-card {
    background: linear-gradient(135deg, rgba(30, 30, 50, 0.8), rgba(20, 20, 35, 0.8));
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    display: grid;
    grid-template-rows: auto auto auto;
    gap: 8px;
    justify-items: center;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
    border-color: rgba(59, 130, 246, 0.4);
    box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
  }
  
  .stat-card.purple {
    background: linear-gradient(135deg, rgba(60, 30, 80, 0.6), rgba(40, 20, 60, 0.6));
    border-color: rgba(139, 92, 246, 0.3);
  }
  
  .stat-card.teal {
    background: linear-gradient(135deg, rgba(20, 60, 70, 0.6), rgba(10, 40, 50, 0.6));
    border-color: rgba(6, 182, 212, 0.3);
  }
  
  .stat-card.red {
    background: linear-gradient(135deg, rgba(70, 30, 40, 0.6), rgba(50, 20, 30, 0.6));
    border-color: rgba(236, 72, 153, 0.3);
  }
  
  .stat-icon {
    font-size: 32px;
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: 700;
  }
  
  .stat-label {
    font-size: 14px;
    color: #94a3b8;
  }
  
  .start-practice-btn {
    background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
    border: none;
    border-radius: 20px;
    padding: 24px;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 16px;
    transition: all 0.3s ease;
    box-shadow: 0 10px 40px rgba(6, 182, 212, 0.3);
    margin: 24px 0;
    cursor: pointer;
    color: white;
  }
  
  .start-practice-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 50px rgba(6, 182, 212, 0.5);
  }
  
  .start-practice-content {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 16px;
  }
  
  .play-icon-wrapper {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    display: grid;
    place-items: center;
  }
  
  .play-icon-wrapper i {
    font-size: 28px;
  }
  
  .start-text {
    text-align: left;
  }
  
  .start-text h3 {
    font-size: 22px;
    font-weight: 700;
    margin: 0 0 4px 0;
  }
  
  .start-text p {
    font-size: 14px;
    margin: 0;
    opacity: 0.9;
  }
  
  .arrow-icon {
    font-size: 24px;
  }
  
  /* Action Cards Grid */
  .actions-container {
    display: grid;
    gap: 16px;
  }
  
  .action-card {
    background: linear-gradient(135deg, rgba(30, 30, 50, 0.6), rgba(20, 20, 35, 0.6));
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 16px;
    padding: 20px;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 16px;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .action-card:hover {
    background: linear-gradient(135deg, rgba(40, 40, 60, 0.6), rgba(30, 30, 45, 0.6));
    border-color: rgba(59, 130, 246, 0.4);
    transform: translateX(5px);
  }
  
  .action-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
    border-radius: 12px;
    display: grid;
    place-items: center;
  }
  
  .action-icon i {
    font-size: 24px;
    color: #3b82f6;
  }
  
  .action-text h4 {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
  }
  
  .action-arrow {
    color: #64748b;
    font-size: 20px;
  }
  
  .tip-card {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(59, 130, 246, 0.15));
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 16px;
    padding: 20px;
    margin-top: 16px;
    display: grid;
    gap: 12px;
  }
  
  .tip-header {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 10px;
  }
  
  .tip-icon {
    color: #fbbf24;
    font-size: 24px;
  }
  
  .tip-title {
    font-size: 18px;
    font-weight: 700;
    color: #fbbf24;
    margin: 0;
  }
  
  .tip-text {
    font-size: 14px;
    color: #cbd5e1;
    line-height: 1.6;
    margin: 0;
  }
  
  /* Notification badge */
  .notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ef4444;
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
  }
  
  /* Responsive Design with CSS Grid */
  @media (max-width: 576px) {
    .app-header {
      padding: 16px;
    }
    
    .stats-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .stat-card {
      padding: 16px 12px;
    }
    
    .stat-value {
      font-size: 24px;
    }
    
    .stat-icon {
      font-size: 24px;
    }
    
    .stat-label {
      font-size: 12px;
    }
    
    .start-text h3 {
      font-size: 18px;
    }
    
    .play-icon-wrapper {
      width: 50px;
      height: 50px;
    }
    
    .play-icon-wrapper i {
      font-size: 24px;
    }

    .settings-btn {
      width: 36px;
      height: 36px;
    }

    .header-actions {
      gap: 6px;
    }
  }
  
  @media (max-width: 400px) {
    .stats-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    .stat-card {
      grid-template-columns: auto 1fr;
      grid-template-rows: auto;
      text-align: left;
      padding: 16px;
    }
    
    .stat-icon {
      grid-row: 1 / 3;
    }
  }
</style>

<!-- Skip to main content link for accessibility -->
<a href="#main-content" class="skip-to-main">Skip to main content</a>

<header class="app-header" role="banner">
  <!-- Left side: Logo and title -->
  <div class="header-left">
    <div class="logo-small" aria-hidden="true">
      <i class="bi bi-lightning-charge-fill" style="color: white; font-size: 20px;"></i>
    </div>
    <div>
      <h1 class="mb-0" style="font-size: 24px; font-weight: 700;">DanceBud</h1>
      <p class="mb-0" style="font-size: 14px; color: #06b6d4;">Your Pocket-size Dance Coach</p>
    </div>
  </div>
  
  <!-- Right side: Action buttons (horizontal layout) -->
  <div class="header-actions">
    <!-- Theme Toggle Button -->
    <button 
      id="theme-toggle" 
      class="icon-btn" 
      onclick="ThemeManager.toggle()"
      title="Switch Theme">
      <i class="bi bi-moon-stars-fill"></i>
    </button>
    
    <!-- Notifications Button -->
    <button 
      class="icon-btn notification-btn" 
      onclick="Navigation.navigate('notifications')">
      <i class="bi bi-bell-fill"></i>
      <span class="badge" id="notification-badge">3</span>
    </button>
    
    <!-- Settings Button -->
    <button 
      class="icon-btn" 
      onclick="Navigation.navigate('settings')">
      <i class="bi bi-gear-fill"></i>
    </button>
  </div>
</div>
</header>

<main id="main-content" role="main" style="padding: 20px; max-width: 600px; margin: 0 auto;">
  <!-- Stats Grid (Pure CSS Grid) -->
  <section aria-labelledby="stats-heading">
    <h2 id="stats-heading" class="visually-hidden">Your Statistics</h2>
    <div class="stats-grid">
      <div class="stat-card purple">
        <div class="stat-icon" aria-hidden="true">
          <i class="bi bi-activity" style="color: #a855f7;"></i>
        </div>
        <div class="stat-value" id="total-sessions">0</div>
      <div class="stat-label">Sessions</div>
    </div>
    
    <div class="stat-card teal">
      <div class="stat-icon" aria-hidden="true">
        <i class="bi bi-bullseye" style="color: #06b6d4;"></i>
      </div>
      <div class="stat-value" id="avg-score">0%</div>
      <div class="stat-label">Avg Score</div>
    </div>
    
    <div class="stat-card red">
      <div class="stat-icon" aria-hidden="true">
        <i class="bi bi-graph-up-arrow" style="color: #ec4899;"></i>
      </div>
      <div class="stat-value" id="total-time">0m</div>
      <div class="stat-label">Total Time</div>
    </div>
  </div>
  </section>

  <!-- Start Practice Button -->
  <button class="start-practice-btn fade-in" onclick="startPractice()" aria-label="Start a new practice session">
    <div class="start-practice-content">
      <div class="play-icon-wrapper" aria-hidden="true">
        <i class="bi bi-play-fill"></i>
      </div>
      <div class="start-text">
        <h3>Start Practice</h3>
        <p>Begin your dance session</p>
      </div>
    </div>
    <i class="bi bi-chevron-right arrow-icon" aria-hidden="true"></i>
  </button>

  <!-- Actions Container (CSS Grid) -->
  <nav aria-labelledby="actions-heading">
    <h2 id="actions-heading" class="visually-hidden">Actions</h2>
    <div class="actions-container">
      <button class="action-card slide-in-up" onclick="browseRoutines()" aria-label="Browse dance routines">
        <div class="action-icon" aria-hidden="true">
          <i class="bi bi-music-note-list"></i>
        </div>
        <div class="action-text">
          <h4>Browse Routines</h4>
        </div>
        <i class="bi bi-chevron-right action-arrow" aria-hidden="true"></i>
      </button>

      <button class="action-card slide-in-up" onclick="viewHistory()" aria-label="View session history">
        <div class="action-icon" style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(139, 92, 246, 0.2));" aria-hidden="true">
          <i class="bi bi-clock-history" style="color: #06b6d4;"></i>
        </div>
        <div class="action-text">
          <h4>Session History</h4>
        </div>
        <i class="bi bi-chevron-right action-arrow" aria-hidden="true"></i>
      </button>
    </div>
  </nav>

  <!-- Tip Card -->
  <aside class="tip-card" role="note" aria-labelledby="tip-title">
    <div class="tip-header">
      <i class="bi bi-lightning-charge-fill tip-icon" aria-hidden="true"></i>
      <h3 class="tip-title" id="tip-title">Pro Tip</h3>
    </div>
    <p class="tip-text" id="daily-tip">Keep your phone in landscape mode for better pose detection during practice sessions!</p>
  </aside>
</main>

<script>
  // Load home stats on screen load
  (function() {
    if (typeof loadHomeStats === 'function') {
      loadHomeStats().catch(err => console.warn('loadHomeStats error:', err));
    }
    if (typeof updateHeaderThemeIcon === 'function') {
      updateHeaderThemeIcon(ThemeSystem?.getTheme() || 'dark');
    }
  })();

  async function loadHomeStats() {
    // Utilise Database pour récupérer les stats
    let stats = null;
    try {
      if (typeof Database !== 'undefined') {
        // Ensure DB initialized if available
        if (Database.init) {
          await Database.init();
        }
        if (Database.getStatistics) {
          stats = await Database.getStatistics();
        }
      }
    } catch (err) {
      console.warn('loadHomeStats: Database error, will use fallback', err);
      stats = null;
    }

    // Retry once if stats missing (sometimes DB may be still warming up)
    if (!stats || typeof stats.totalSessions === 'undefined') {
      try {
        await new Promise(r => setTimeout(r, 250));
        if (typeof Database !== 'undefined' && Database.getStatistics) {
          stats = await Database.getStatistics();
        }
      } catch (err) {
        console.warn('loadHomeStats retry failed:', err);
      }
    }

    if (!stats) {
      // fallback si Database non dispo
      stats = { totalSessions: 0, avgScore: 0, totalTime: 0 };
    }
    const elSessions = document.getElementById('total-sessions');
    const elAvgScore = document.getElementById('avg-score');
    const elTotalTime = document.getElementById('total-time');
    if (elSessions) elSessions.textContent = Number(stats.totalSessions || 0);
    if (elAvgScore) elAvgScore.textContent = (Math.round(Number(stats.avgScore) || 0)) + '%';
    // totalTime en minutes
    const totalMinutes = Math.floor((Number(stats.totalTime) || 0) / 60);
    const totalHours = Math.floor(totalMinutes / 60);
    if (elTotalTime) {
      if (totalMinutes >= 60) {
        elTotalTime.textContent = totalHours + 'h';
      } else {
        elTotalTime.textContent = totalMinutes + 'm';
      }
    }
    showRandomTip();
    updateNotificationBadge();
  }

  function showRandomTip() {
    const elTip = document.getElementById('daily-tip');
    if (!elTip) return;
    const tips = [
      'Keep your phone in landscape mode for better pose detection during practice sessions!',
      'Make sure you have good lighting for accurate motion tracking.',
      'Stand 3-4 feet away from your camera for optimal results.',
      'Warm up before each practice session to prevent injuries and improve performance.',
      'Consistency is key - practice a little every day for best results!',
      'Review your session history to track your progress over time.',
      'Try different music tempos to challenge yourself and improve rhythm.',
      'Stay hydrated during your dance sessions for peak performance!',
      'Grant camera and microphone permissions for the best experience.',
      'Practice in a clear space to avoid obstacles during your session.'
    ];
    
    const randomTip = tips[Math.floor(Math.random() * tips.length)];
    elTip.textContent = randomTip;
  }

  function startPractice() {
    if (typeof Navigation !== 'undefined' && Navigation.navigate) {
      Navigation.navigate('practice');
    } else {
      alert('Practice screen coming soon!');
    }
  }

  function browseRoutines() {
    if (typeof Navigation !== 'undefined' && Navigation.navigate) {
      Navigation.navigate('routines');
    } else {
      alert('Routines screen coming soon!');
    }
  }

  function viewHistory() {
    if (typeof Navigation !== 'undefined' && Navigation.navigate) {
      Navigation.navigate('history');
    } else {
      alert('History screen coming soon!');
    }
  }

  function navigateToSettings() {
    if (typeof Navigation !== 'undefined' && Navigation.navigate) {
      Navigation.navigate('settings');
    } else {
      alert('Settings screen coming soon!');
    }
  }

  // Quick theme toggle
  async function quickToggleTheme() {
    if (typeof ThemeSystem !== 'undefined' && ThemeSystem.toggle) {
      const newTheme = await ThemeSystem.toggle();
      updateHeaderThemeIcon(newTheme);
    } else {
      console.warn('ThemeSystem not available');
    }
  }

  function updateHeaderThemeIcon(theme) {
    const icon = document.getElementById('headerThemeIcon');
    if (icon) {
      icon.className = theme === 'dark' 
        ? 'bi bi-moon-stars' 
        : 'bi bi-sun';
      icon.style.color = '#fbbf24';
      icon.style.fontSize = '20px';
    }
  }

  // Show notifications (placeholder)
  function showNotifications() {
    if (typeof Navigation !== 'undefined' && Navigation.navigate) {
      Navigation.navigate('notifications');
    } else {
      alert('Notifications feature coming soon!');
    }
  }

  // Update notification badge
  function updateNotificationBadge() {
    const badge = document.getElementById('notificationBadge');
    if (!badge) return;
    const unreadCount = 0;
    if (unreadCount > 0) {
      badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
      badge.style.display = 'block';
    } else {
      badge.style.display = 'none';
    }
  }

  // Auto-refresh stats every 30 seconds
  setInterval(() => {
    loadHomeStats();
  }, 30000);
</script>