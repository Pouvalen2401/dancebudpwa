<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ===== META TAGS ===== -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#06b6d4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- SEO Meta Tags -->
  <meta name="description"
    content="DanceBud - Your pocket-size dance coach. Learn, practice, and improve your dance moves with real-time feedback.">
  <meta name="keywords" content="dance, coach, practice, dancing, learning, PWA">
  <meta name="author" content="Team DanceBud">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="DanceBud - Dance Coach">
  <meta property="og:description" content="Your personal dance coach for learning and improving dance moves">
  <meta property="og:image" content="assets/icons/icon-512x512.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DanceBud - Dance Coach">
  <meta name="twitter:description" content="Your pocket-size dance coach">

  <title>DanceBud - Your pocket-size Dance Coach</title>

  <!-- ===== BOOTSTRAP CSS ===== -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

  <!-- ===== BOOTSTRAP ICONS ===== -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- ===== CUSTOM CSS ===== -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animations.css">

  <!-- ===== PWA MANIFEST ===== -->
  <link rel="manifest" href="manifest.json">


  <!-- ===== FAVICONS ===== -->
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/icons/icon-512x512.png">
  <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
  <link rel="shortcut icon" href="assets/icons/icon-192x192.png">

  <!-- Preconnect for faster loading -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
</head>

<body>
  <!-- ==========================================
       MAIN APP CONTAINER
       All screens will load here dynamically
       ========================================== -->
  <div id="app-container" class="min-vh-100">
    <!-- Loading fallback (shows while JS loads) -->
    <div class="d-flex align-items-center justify-content-center min-vh-100">
      <div class="text-center">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted">Loading DanceBud...</p>
      </div>
    </div>
  </div>

  <!-- ===== OFFLINE NOTIFICATION ===== -->
  <div id="offline-notification" class="position-fixed bottom-0 start-50 translate-middle-x mb-3 d-none"
    style="z-index: 9999;">
    <div class="alert alert-warning d-flex align-items-center shadow-lg" role="alert">
      <i class="bi bi-wifi-off me-2"></i>
      <span>You're offline. Some features may be unavailable.</span>
    </div>
  </div>

  <!-- ===== UPDATE NOTIFICATION ===== -->
  <div id="update-notification" class="position-fixed bottom-0 start-50 translate-middle-x mb-3 d-none"
    style="z-index: 9999;">
    <div class="alert alert-info d-flex align-items-center shadow-lg" role="alert">
      <i class="bi bi-arrow-clockwise me-2"></i>
      <span>New version available!</span>
      <button class="btn btn-sm btn-primary ms-3" onclick="location.reload()">Update</button>
    </div>
  </div>

  <!-- ==========================================
       JAVASCRIPT LIBRARIES
       Order matters! Load in sequence
       ========================================== -->

  <!-- ===== BOOTSTRAP BUNDLE (includes Popper.js) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>

  <!-- ===== TENSORFLOW.JS (for pose detection) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js"></script>

  <!-- ===== CHART.JS (for analytics graphs) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

  <!-- ==========================================
       CUSTOM JAVASCRIPT MODULES
       ‚ö†Ô∏è ORDER IS CRITICAL! ‚ö†Ô∏è
       Load utilities first, then features, then app
       ========================================== -->

  <!-- 1. Storage Module (needed by all others) -->
  <script src="js/config.js"></script>
  <script src="js/storage.js"></script>

  <!-- 2. Database Module  -->
  <script src="js/database.js"></script>

  <!-- 3. Notif Module  -->

  <script src="js/notifications.js"></script>

  <!-- 4. Theme Module (for dark/light toggle) -->
  <script src="js/theme.js"></script>
  
  <!-- 5. Sensor Modules (camera, audio, motion) -->
  <script src="js/camera.js"></script>
  <script src="js/audio.js"></script>
  <script src="js/motion.js"></script>


  <script src="js/online-detector.js"></script>

  <!-- 5. Session Manager (uses storage and sensors) -->
  <script src="js/session.js"></script>

  <!-- 6. Navigation System (loads screens) -->
  <script src="js/navigation.js"></script>

  <!-- 7. Main App (initializes everything) -->
  <script src="js/app.js"></script>

  <!-- ===== SERVICE WORKER REGISTRATION ===== -->
  <script>
    // Register Service Worker for PWA functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('‚úÖ Service Worker registered:', registration.scope);

            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // Show update notification
                  document.getElementById('update-notification').classList.remove('d-none');
                }
              });
            });
          })
          .catch(error => {
            console.log('‚ùå Service Worker registration failed:', error);
            document.getElementById('offline-notification').classList.remove('d-none');
            console.log('üìµ You are offline');
          });
      });
    }

    // Prevent zoom on iOS
    document.addEventListener('gesturestart', function(e) {
      e.preventDefault();
      document.body.style.zoom = 0.99;
    });

    document.addEventListener('gesturechange', function(e) {
      e.preventDefault();
      document.body.style.zoom = 0.99;
    });

    document.addEventListener('gestureend', function(e) {
      e.preventDefault();
      document.body.style.zoom = 1;
    });
  </script>

  <!-- ===== CONSOLE BRANDING ===== -->
  <script>
        // Cool console message for developers
        console.log('%c DanceBud üéµ ',
          'background: linear-gradient(135deg, #06b6d4, #a855f7); color: white; font-size: 24px; padding: 10px 20px; border-radius: 10px; font-weight: bold;'
        );
        console.log('%c Dance Coach PWA v1.0.0 ',
          'background: #1a1a1a; color: #06b6d4; font-size: 14px; padding: 5px 10px; border-radius: 5px;'
        );
        console.log('%c Built with ‚ù§Ô∏è by Team DanceBud ',
          'color: #a855f7; font-size: 12px;'
        );
        console.log('%c Technologies: Bootstrap 5, TensorFlow.js, Chart.js, Web APIs ',
          'color: #10b981; font-size: 10px;'
        );
        console.log('\nüöÄ App initialized successfully!\n');
  </script>

  <!-- ===== PERFORMANCE MONITORING (Optional) ===== -->
  <script>
        // Log page load performance
        window.addEventListener('load', () => {
          setTimeout(() => {
            const perfData = performance.getEntriesByType('navigation')[0];
            if (perfData) {
              const loadTime = perfData.loadEventEnd - perfData.fetchStart;
              console.log(`‚è±Ô∏è Page loaded in ${loadTime.toFixed(2)}ms`);
            }
          }, 0);
        });
  </script>

  <!-- ===== ERROR HANDLING ===== -->
  <script>
        // Global error handler
        window.addEventListener('error', (event) => {
          console.error('üí• Global error:', event.error);

          // Show user-friendly error message
          const appContainer = document.getElementById('app-container');
          if (appContainer && !appContainer.querySelector('.error-screen')) {
            const errorHTML = `
          <div class="error-screen min-vh-100 d-flex align-items-center justify-content-center p-4">
            <div class="text-center">
              <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 4rem;"></i>
              <h2 class="mt-4 mb-3">Oops! Something went wrong</h2>
              <p class="text-muted mb-4">We're sorry, but something unexpected happened.</p>
              <button class="btn btn-primary" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise me-2"></i>Reload App
              </button>
            </div>
          </div>
        `;
            // Only show error if it's critical
            if (event.error && event.error.message.includes('critical')) {
              appContainer.innerHTML = errorHTML;
            }
          }
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
          console.error('üí• Unhandled promise rejection:', event.reason);
          event.preventDefault(); // Prevent default browser behavior
        });
  </script>

  <!-- ===== ACCESSIBILITY ENHANCEMENTS ===== -->
  <script>
        // Announce screen changes to screen readers
        function announceToScreenReader(message) {
          const announcement = document.createElement('div');
          announcement.setAttribute('role', 'status');
          announcement.setAttribute('aria-live', 'polite');
          announcement.className = 'visually-hidden';
          announcement.textContent = message;
          document.body.appendChild(announcement);

          setTimeout(() => {
            document.body.removeChild(announcement);
          }, 1000);
        }

        // Make it globally available
        window.announceToScreenReader = announceToScreenReader;
  </script>

  <!-- ===== INSTALL PROMPT (PWA) ===== -->
  <script>
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
          // Prevent the mini-infobar from appearing on mobile
          e.preventDefault();
          // Save the event so it can be triggered later
          deferredPrompt = e;
          console.log('üíæ Install prompt available');

          // Show custom install button (if you create one)
          const installButton = document.getElementById('install-button');
          if (installButton) {
            installButton.classList.remove('d-none');
          }
        });

        // Function to show install prompt (call this from your UI)
        window.showInstallPrompt = async function () {
          if (!deferredPrompt) {
            console.log('Install prompt not available');
            return;
          }

          // Show the install prompt
          deferredPrompt.prompt();

          // Wait for the user's response
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response to install prompt: ${outcome}`);

          // Clear the prompt
          deferredPrompt = null;
        };

        // Track successful installation
        window.addEventListener('appinstalled', () => {
          console.log('üéâ DanceBud has been installed!');
          deferredPrompt = null;
        });
  </script>

  <!-- ===== DEVICE DETECTION ===== -->
  <script>
        // Detect device type and add to body class
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);

        if (isMobile) document.body.classList.add('mobile-device');
        if (isIOS) document.body.classList.add('ios-device');
        if (isAndroid) document.body.classList.add('android-device');

        console.log(`üì± Device: ${isMobile ? 'Mobile' : 'Desktop'}`);
        if (isMobile) {
          console.log(`üì± Platform: ${isIOS ? 'iOS' : isAndroid ? 'Android' : 'Other'}`);
        }
  </script>

  <!-- ===== ORIENTATION CHANGE HANDLER ===== -->
  <script>
        // Handle screen orientation changes
        window.addEventListener('orientationchange', () => {
          console.log(`üì± Orientation changed to: ${screen.orientation?.type || 'unknown'}`);

          // Notify user if landscape is recommended
          const currentScreen = window.Navigation?.currentScreen;
          if (currentScreen === 'practice' && screen.orientation?.type.includes('portrait')) {
            // You could show a toast here suggesting landscape mode
            console.log('üí° Tip: Landscape mode recommended for practice screen');
          }
        });
  </script>



      
</body>

</html>